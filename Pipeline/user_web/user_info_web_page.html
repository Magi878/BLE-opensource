<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ä¿¡æ¯é…ç½® - é¥±äº†å—</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .left-panel {
            width: 30%;
            background: #f8f9fa;
            padding: 30px;
            border-right: 2px solid #e0e0e0;
            overflow-y: auto;
        }

        .center-panel {
            width: 40%;
            padding: 30px;
            overflow-y: auto;
            border-right: 2px solid #e0e0e0;
        }

        .right-panel {
            width: 30%;
            padding: 30px;
            overflow-y: auto;
            background: #f5f5f5;
        }

        .current-config {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .default-users {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .default-users h3 {
            color: #1565c0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .user-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .user-btn {
            padding: 10px;
            background: #bbdefb;
            border: 1px solid #90caf9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9em;
        }

        .user-btn:hover {
            background: #90caf9;
            transform: translateY(-2px);
        }

        .user-details {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            border: 1px solid #a5d6a7;
        }

        .user-details h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .select-user-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-user-btn:hover {
            background: #388e3c;
        }

        .current-config h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .config-item {
            margin-bottom: 10px;
            color: #333;
            font-size: 0.95em;
        }

        .config-item strong {
            color: #2e7d32;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9em;
        }

        .checkbox-item:hover {
            background: #e3f2fd;
            transform: translateY(-1px);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.1);
            accent-color: #4facfe;
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9em;
        }

        .radio-item:hover {
            background: #e3f2fd;
            transform: translateY(-1px);
        }

        .radio-item input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.1);
            accent-color: #4facfe;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(-1px);
        }

        /* ç»“æœå±•ç¤ºåŒºåŸŸæ ·å¼ */
        .result-container {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .result-content {
            color: #666;
        }

        .result-time {
            font-size: 0.8em;
            color: #999;
            text-align: right;
        }

        .result-duration {
            font-size: 0.9em;
            color: #4CAF50;
            font-weight: bold;
        }

        @media (max-width: 1200px) {
            .left-panel, .center-panel, .right-panel {
                width: 50%;
            }
            .right-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
                height: calc(100vh - 20px);
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .left-panel, .center-panel, .right-panel {
                width: 100%;
                padding: 20px;
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
            }
            
            .checkbox-group, .radio-group {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ½ï¸ é¥±äº†å—</h1>
            <p>ä¸ªæ€§åŒ–ç”¨æˆ·ä¿¡æ¯é…ç½®</p>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div id="currentConfig" class="current-config">
                    <h3>ğŸ“‹ å½“å‰é…ç½®</h3>
                    <div id="configDisplay">
                        <div class="config-item">æš‚æ— é…ç½®ä¿¡æ¯</div>
                    </div>

                    <div class="default-users">
                        <h3>ğŸ‘¥ é»˜è®¤ç”¨æˆ·</h3>
                        <div class="user-buttons" id="defaultUsers">
                            <!-- è¿™é‡Œå°†é€šè¿‡JSåŠ¨æ€åŠ è½½é»˜è®¤ç”¨æˆ·æŒ‰é’® -->
                        </div>
                        <div class="user-details" id="userDetails" style="display: none;">
                            <h4>ç”¨æˆ·è¯¦æƒ…</h4>
                            <div id="userDetailsContent"></div>
                            <button class="select-user-btn" id="selectUserBtn">é€‰æ‹©æ­¤ç”¨æˆ·</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="center-panel">
                <form id="userForm">
                    <div class="form-group">
                        <label for="user_id">ğŸ‘¤ ç”¨æˆ·ID</label>
                        <input type="number" id="user_id" name="user_id" class="form-control" required min="1">
                    </div>

                    <div class="form-group">
                        <label for="name">ğŸ“ å§“å</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label>ğŸ‘« æ€§åˆ«</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="gender" value="Male" required>
                                <span>ç”·æ€§</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="gender" value="Female" required>
                                <span>å¥³æ€§</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ‚ å¹´é¾„æ®µ</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="age_range" value="60-70" required>
                                <span>60-70å²</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="age_range" value="70-80" required>
                                <span>70-80å²</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="age_range" value="80-90" required>
                                <span>80-90å²</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸŒ åœ°åŒº</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="region" value="ä¸œåŒ—åœ°åŒº" required>
                                <span>ä¸œåŒ—åœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="è¥¿åŒ—åœ°åŒº" required>
                                <span>è¥¿åŒ—åœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="ååŒ—åœ°åŒº" required>
                                <span>ååŒ—åœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="åä¸œåœ°åŒº" required>
                                <span>åä¸œåœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="åä¸­åœ°åŒº" required>
                                <span>åä¸­åœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="è¥¿å—åœ°åŒº" required>
                                <span>è¥¿å—åœ°åŒº</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="region" value="åå—åœ°åŒº" required>
                                <span>åå—åœ°åŒº</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ¥ å¥åº·çŠ¶å†µï¼ˆå¯å¤šé€‰, å¥åº·ä¸ç–¾ç—…äº’æ–¥ï¼‰</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="è‚¥èƒ–">
                                <span>è‚¥èƒ–</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="é«˜è¡€å‹">
                                <span>é«˜è¡€å‹</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="ç³–å°¿ç—…">
                                <span>ç³–å°¿ç—…</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="è‚¾ç—…">
                                <span>è‚¾ç—…</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="é«˜è¡€è„‚">
                                <span>é«˜è¡€è„‚</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="é«˜è¡€ç³–">
                                <span>é«˜è¡€ç³–</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="èƒƒç—…">
                                <span>èƒƒç—…</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="å…³èŠ‚ç‚">
                                <span>å…³èŠ‚ç‚</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="ä¾¿ç§˜">
                                <span>ä¾¿ç§˜</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="health_conditions" value="å¥åº·" id="healthy">
                                <span>å¥åº·</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ‘… å£å‘³åå¥½</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="æ¸…æ·¡" required>
                                <span>æ¸…æ·¡</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="é…¸" required>
                                <span>é…¸å‘³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="é²œ" required>
                                <span>é²œå‘³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="ç”œ" required>
                                <span>ç”œå‘³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="è¾£" required>
                                <span>è¾£å‘³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="å’¸" required>
                                <span>å’¸å‘³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="taste_preferences" value="è‹¦" required>
                                <span>è‹¦å‘³</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ğŸ¥¢ å£æ„Ÿåå¥½</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="è½¯çƒ‚" required>
                                <span>è½¯çƒ‚</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="æ˜“å’€åš¼" required>
                                <span>æ˜“å’€åš¼</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="é¡ºæ»‘" required>
                                <span>é¡ºæ»‘</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="æ¸©çƒ­" required>
                                <span>æ¸©çƒ­</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="æ¸…å‡‰" required>
                                <span>æ¸…å‡‰</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="å¸¸æ¸©" required>
                                <span>å¸¸æ¸©</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="é…¥è„†" required>
                                <span>é…¥è„†</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="Qå¼¹" required>
                                <span>Qå¼¹</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="texture_preferences" value="ç­‹é“" required>
                                <span>ç­‹é“</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">âœ¨ ä¿å­˜é…ç½®</button>
                </form>
            </div>

            <div class="right-panel">
                <h3>ğŸ“Š è¯­éŸ³è¯†åˆ«ç»“æœ</h3>
                <div id="resultHistory" class="result-container">
                    <div class="result-item">
                        <div class="result-content">æš‚æ— è¯†åˆ«è®°å½•</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨å½“å‰ç”¨æˆ·çš„å†å²è®°å½•
        let currentUserOrderHistory = [];
        // å…¨å±€å˜é‡å­˜å‚¨å½“å‰ç”¨æˆ·é…ç½®
        let currentUserConfig = {};
        // å…¨å±€å˜é‡å­˜å‚¨è¯†åˆ«ç»“æœå†å²
        let recognitionHistory = [];

        // åˆå§‹åŒ–WebSocketè¿æ¥
        let socket;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–WebSocketè¿æ¥
        window.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–Socket.IOè¿æ¥
            socket = io();
            
            // ç›‘å¬è¿æ¥çŠ¶æ€
            socket.on('connect', function() {
                console.log('å·²è¿æ¥åˆ°æœåŠ¡å™¨');
            });
            
            socket.on('disconnect', function() {
                console.log('ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
            });
            
            // ç›‘å¬è¯†åˆ«ç»“æœ
            socket.on('recognition_result', function(data) {
                console.log('æ”¶åˆ°è¯†åˆ«ç»“æœ:', data);
                addRecognitionResult(data);
            });
            
            // åŸæœ‰çš„åˆå§‹åŒ–ä»£ç 
            loadCurrentConfig();
            loadDefaultUsers();
        });

        // å¥åº·çŠ¶å†µäº’æ–¥é€»è¾‘
        const healthCheckboxes = document.querySelectorAll('input[name="health_conditions"]');
        const healthyCheckbox = document.getElementById('healthy');
        
        healthCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.value === 'å¥åº·') {
                    if (this.checked) {
                        // é€‰æ‹©å¥åº·æ—¶ï¼Œå–æ¶ˆå…¶ä»–æ‰€æœ‰ç–¾ç—…é€‰æ‹©
                        healthCheckboxes.forEach(cb => {
                            if (cb.value !== 'å¥åº·') {
                                cb.checked = false;
                            }
                        });
                    }
                } else {
                    // é€‰æ‹©ç–¾ç—…æ—¶ï¼Œå–æ¶ˆå¥åº·é€‰æ‹©
                    if (this.checked) {
                        healthyCheckbox.checked = false;
                    }
                }
            });
        });

        // é¡µé¢åŠ è½½æ—¶è·å–å½“å‰é…ç½®
        window.addEventListener('DOMContentLoaded', function() {
            loadCurrentConfig();
            loadDefaultUsers();
        });

        // åŠ è½½é»˜è®¤ç”¨æˆ·
        function loadDefaultUsers() {
            fetch('/get_default_users', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200 && data.data && data.data.length > 0) {
                    displayDefaultUsers(data.data);
                }
            })
            .catch(error => {
                console.log('è·å–é»˜è®¤ç”¨æˆ·å¤±è´¥:', error);
            });
        }

        // æ˜¾ç¤ºé»˜è®¤ç”¨æˆ·æŒ‰é’®
        function displayDefaultUsers(users) {
            const usersContainer = document.getElementById('defaultUsers');
            usersContainer.innerHTML = '';
            
            users.forEach(user => {
                const btn = document.createElement('button');
                btn.className = 'user-btn';
                btn.textContent = user.name;
                btn.onclick = () => showUserDetails(user);
                usersContainer.appendChild(btn);
            });
        }

        // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…
        function showUserDetails(user) {
            const detailsContainer = document.getElementById('userDetailsContent');
            const userDetailsSection = document.getElementById('userDetails');
            
            // æ ¼å¼åŒ–è®¢å•å†å²
            const orderHistory = user.order_history || [];
            const ordersHtml = orderHistory.map(order => 
                `<div><strong>${order.date}:</strong> ${order.dishes.join(', ')}</div>`
            ).join('');
            
            detailsContainer.innerHTML = `
                <div><strong>ID:</strong> ${user.id}</div>
                <div><strong>å§“å:</strong> ${user.name}</div>
                <div><strong>æ€§åˆ«:</strong> ${user.gender}</div>
                <div><strong>å¹´é¾„æ®µ:</strong> ${user.age_range}</div>
                <div><strong>åœ°åŒº:</strong> ${user.region}</div>
                <div><strong>å¥åº·çŠ¶å†µ:</strong> ${user.health_conditions.join(', ')}</div>
                <div><strong>å£å‘³åå¥½:</strong> ${user.taste_preferences.join(', ')}</div>
                <div><strong>å£æ„Ÿåå¥½:</strong> ${user.texture_preferences.join(', ')}</div>
                
                <div style="margin-top: 15px;"><strong>è®¢å•å†å²:</strong></div>
                <div style="max-height: 200px; overflow-y: auto; margin-top: 5px;">
                    ${ordersHtml}
                </div>
            `;
            
            // è®¾ç½®é€‰æ‹©æŒ‰é’®äº‹ä»¶
            document.getElementById('selectUserBtn').onclick = () => selectUser(user);
            
            userDetailsSection.style.display = 'block';
        }

        // é€‰æ‹©ç”¨æˆ·
        function selectUser(user) {
            // ä¿å­˜å†å²è®°å½•
            currentUserOrderHistory = user.order_history || [];
            
            // å¡«å……è¡¨å•
            fillForm(user);
            
            // éšè—è¯¦æƒ…
            document.getElementById('userDetails').style.display = 'none';
            
            // æ˜¾ç¤ºå½“å‰é…ç½®
            displayCurrentConfig(user);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°è¡¨å•é¡¶éƒ¨
            document.querySelector('.center-panel').scrollTo(0, 0);
        }

        // åŠ è½½å½“å‰é…ç½®
        function loadCurrentConfig() {
            fetch('/get_user_config', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200 && data.data) {
                    // ä¿å­˜å†å²è®°å½•
                    currentUserOrderHistory = data.data.order_history || [];
                    currentUserConfig = data.data;
                    displayCurrentConfig(data.data);
                    fillForm(data.data);
                }
            })
            .catch(error => {
                console.log('è·å–é…ç½®å¤±è´¥:', error);
            });
        }

        // æ˜¾ç¤ºå½“å‰é…ç½®
        function displayCurrentConfig(config) {
            const configDiv = document.getElementById('configDisplay');
            
            // æ ¼å¼åŒ–è®¢å•å†å²
            const orderHistory = config.order_history || [];
            const ordersHtml = orderHistory.length > 0 
                ? orderHistory.map(order => 
                    `<div><strong>${order.date}:</strong> ${order.dishes.join(', ')}</div>`
                ).join('')
                : '<div>æ— å†å²è®°å½•</div>';
            
            configDiv.innerHTML = `
                <div class="config-item"><strong>ç”¨æˆ·ID:</strong> ${config.id || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>å§“å:</strong> ${config.name || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>æ€§åˆ«:</strong> ${config.gender || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>å¹´é¾„æ®µ:</strong> ${config.age_range || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>åœ°åŒº:</strong> ${config.region || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>å¥åº·çŠ¶å†µ:</strong> ${(config.health_conditions || []).join(', ') || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>å£å‘³åå¥½:</strong> ${config.taste_preferences || 'æœªè®¾ç½®'}</div>
                <div class="config-item"><strong>å£æ„Ÿåå¥½:</strong> ${config.texture_preferences || 'æœªè®¾ç½®'}</div>
                <div class="config-item" style="margin-top: 15px;"><strong>å†å²è®¢å•:</strong></div>
                <div style="max-height: 200px; overflow-y: auto; margin-top: 5px; padding: 5px; background: #f5f5f5; border-radius: 5px;">
                    ${ordersHtml}
                </div>
            `;
        }

        // å¡«å……è¡¨å•
        function fillForm(config) {
            if (config.id) document.getElementById('user_id').value = config.id;
            if (config.name) document.getElementById('name').value = config.name;
            
            if (config.gender) {
                const genderRadio = document.querySelector(`input[name="gender"][value="${config.gender}"]`);
                if (genderRadio) genderRadio.checked = true;
            }
            
            if (config.age_range) {
                const ageRadio = document.querySelector(`input[name="age_range"][value="${config.age_range}"]`);
                if (ageRadio) ageRadio.checked = true;
            }
            
            if (config.region) {
                const regionRadio = document.querySelector(`input[name="region"][value="${config.region}"]`);
                if (regionRadio) regionRadio.checked = true;
            }
            
            if (config.health_conditions) {
                // å…ˆå–æ¶ˆæ‰€æœ‰é€‰æ‹©
                document.querySelectorAll('input[name="health_conditions"]').forEach(cb => cb.checked = false);
                
                // ç„¶åé€‰æ‹©å½“å‰é…ç½®
                config.health_conditions.forEach(condition => {
                    const checkbox = document.querySelector(`input[name="health_conditions"][value="${condition}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            if (config.taste_preferences) {
                const tasteRadio = document.querySelector(`input[name="taste_preferences"][value="${config.taste_preferences}"]`);
                if (tasteRadio) tasteRadio.checked = true;
            }
            
            if (config.texture_preferences) {
                const textureRadio = document.querySelector(`input[name="texture_preferences"][value="${config.texture_preferences}"]`);
                if (textureRadio) textureRadio.checked = true;
            }
        }

        // æ·»åŠ è¯†åˆ«ç»“æœåˆ°å†å²è®°å½•
        // function addRecognitionResult(resultData) {
        //     recognitionHistory.unshift(resultData);
        //     if (recognitionHistory.length > 5) {
        //         recognitionHistory.pop();
        //     }
        //     updateResultDisplay();
        // }
        // ä¿®æ”¹addRecognitionResultå‡½æ•°ä»¥é€‚åº”æ–°çš„æ•°æ®æ ¼å¼
        function addRecognitionResult(resultData) {
            const newResult = {
                ext: {
                    asr_result: resultData.asr_result,
                    recommended_dish: resultData.recommended_dish,
                    processing_time: resultData.processing_time,
                    timestamp: resultData.timestamp
                }
            };
            
            recognitionHistory.unshift(newResult);
            if (recognitionHistory.length > 10) {  // å¢åŠ å†å²è®°å½•ä¿å­˜æ•°é‡
                recognitionHistory.pop();
            }
            updateResultDisplay();
        }
        // æ›´æ–°ç»“æœå±•ç¤º
        function updateResultDisplay() {
            const resultContainer = document.getElementById('resultHistory');
            
            if (recognitionHistory.length === 0) {
                resultContainer.innerHTML = `
                    <div class="result-item">
                        <div class="result-content">æš‚æ— è¯†åˆ«è®°å½•</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recognitionHistory.forEach(result => {
                html += `
                    <div class="result-item">
                        <div class="result-title">è¯†åˆ«æ–‡æœ¬:</div>
                        <div class="result-content">${result.ext.asr_result}</div>
                        
                        <div class="result-title" style="margin-top: 10px;">æ¨èèœå“:</div>
                        <div class="result-content">${result.ext.recommended_dish}</div>
                        
                        <div class="result-duration">è€—æ—¶: ${result.ext.processing_time}ms</div>
                        <div class="result-time">${result.ext.timestamp}</div>
                    </div>
                `;
            });
            
            resultContainer.innerHTML = html;
        }

        // è¡¨å•æäº¤
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const userInfo = {
                id: parseInt(formData.get('user_id')),
                name: formData.get('name'),
                gender: formData.get('gender'),
                age_range: formData.get('age_range'),
                region: formData.get('region'),
                health_conditions: formData.getAll('health_conditions'),
                taste_preferences: formData.get('taste_preferences'),
                texture_preferences: formData.get('texture_preferences'),
                // ä¿ç•™ç°æœ‰çš„å†å²è®°å½•
                order_history: currentUserOrderHistory || []
            };

            // æ›´æ–°å½“å‰ç”¨æˆ·é…ç½®
            currentUserConfig = userInfo;

            // æäº¤æ•°æ®
            fetch('/set_user_config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userInfo)
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    alert('âœ… é…ç½®ä¿å­˜æˆåŠŸï¼');
                    displayCurrentConfig(userInfo);
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            });
        });

        // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«ç»“æœï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥ä»çœŸå®çš„è¯­éŸ³è¯†åˆ«å›è°ƒä¸­è°ƒç”¨addRecognitionResultï¼‰
        function simulateVoiceRecognition() {
            const mockResponse = {
                code: 200,
                message: "success",
                data: {
                    result: "ç»™æˆ‘ç‚¹æ¸…è’¸é²ˆé±¼",
                    ext: {
                        user_info: currentUserConfig,
                        asr_result: "æˆ‘æƒ³åƒæ¸…è’¸é²ˆé±¼",
                        recommended_dish: "æ¸…è’¸é²ˆé±¼",
                        processing_time: 1250,
                        timestamp: new Date().toLocaleString()
                    }
                }
            };
            
            addRecognitionResult(mockResponse.data);
        }

        // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«æŒ‰é’®ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥è¿æ¥åˆ°çœŸå®çš„è¯­éŸ³è¯†åˆ«æŒ‰é’®ï¼‰
        document.addEventListener('keydown', function(e) {
            if (e.key === 'r' && e.ctrlKey) {
                simulateVoiceRecognition();
            }
        });
    </script>
</body>
</html>